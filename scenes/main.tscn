[gd_scene load_steps=45 format=3 uid="uid://bqd6y7xm7r8e2"]

[ext_resource type="Texture2D" uid="uid://bqlxhxsr63h20" path="res://assets/skybox/night_moonlit_sky.png" id="1_nightsky"]
[ext_resource type="Texture2D" uid="uid://g1l2akl7bpva" path="res://assets/skybox/goose_sky.png" id="1_daysky"]
[ext_resource type="PackedScene" uid="uid://dwehxim8vlojo" path="res://npcs/shopkeeper.tscn" id="2_shopkeeper"]
[ext_resource type="Script" uid="uid://df0kwlb24vvi0" path="res://scripts/follow_camera.gd" id="3_camera"]
[ext_resource type="PackedScene" uid="uid://cplayer001" path="res://player/player.tscn" id="5_player"]
[ext_resource type="Script" uid="uid://bc68lbr02g646" path="res://systems/shop_item.gd" id="6_shop_item"]
[ext_resource type="Script" uid="uid://bkd8iey6km0o5" path="res://systems/day_night_cycle.gd" id="7_daynight"]
[ext_resource type="Shader" uid="uid://cy4ttxsnnp0am" path="res://shaders/toon.gdshader" id="8_jbj1t"]
[ext_resource type="PackedScene" path="res://ui/tod_notification.tscn" id="8_tod_ui"]
[ext_resource type="PackedScene" path="res://ui/npc_info_panel.tscn" id="9_npc_info"]
[ext_resource type="Script" uid="uid://cdm2e4irmkotk" path="res://ui/npc_info_manager.gd" id="10_info_mgr"]
[ext_resource type="Script" uid="uid://br0u1dw415co" path="res://systems/game_speed_manager.gd" id="11_speed"]
[ext_resource type="PackedScene" path="res://ui/tod_clock_widget.tscn" id="12_clock"]
[ext_resource type="Script" uid="uid://dserlv30qf4lu" path="res://scripts/ghibli_shader_applier.gd" id="13_ghibli"]

[sub_resource type="PanoramaSkyMaterial" id="PanoramaSkyMaterial_night"]
panorama = ExtResource("1_nightsky")
energy_multiplier = 0.5

[sub_resource type="Sky" id="Sky_night"]
sky_material = SubResource("PanoramaSkyMaterial_night")

[sub_resource type="Environment" id="Environment_1"]
background_mode = 2
sky = SubResource("Sky_night")
ambient_light_source = 1
ambient_light_color = Color(0.1, 0.15, 0.25, 1)
ambient_light_energy = 0.35
tonemap_mode = 2
fog_enabled = true
fog_light_color = Color(0.45, 0.55, 0.6, 1)
fog_density = 0.005
fog_sky_affect = 1.0

[sub_resource type="CameraAttributesPractical" id="CameraAttributesPractical_1"]

[sub_resource type="NavigationMesh" id="NavigationMesh_1"]
vertices = PackedVector3Array(-249.5, 0.05, -249.5, -249.5, 0.05, 249.5, 249.5, 0.05, 249.5, 249.5, 0.05, -249.5)
polygons = [PackedInt32Array(3, 2, 0), PackedInt32Array(0, 2, 1)]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_floor"]
albedo_color = Color(0.55, 0.7, 0.48, 1)
roughness = 0.95

[sub_resource type="PlaneMesh" id="PlaneMesh_1"]
material = SubResource("StandardMaterial3D_floor")
size = Vector2(2000, 2000)

[sub_resource type="BoxShape3D" id="BoxShape3D_1"]
size = Vector3(2000, 0.1, 2000)

[sub_resource type="StandardMaterial3D" id="mat_apple"]
albedo_color = Color(0.9, 0.2, 0.15, 1)
roughness = 0.7

[sub_resource type="SphereMesh" id="mesh_apple"]
material = SubResource("mat_apple")
radius = 0.12
height = 0.24

[sub_resource type="ShaderMaterial" id="ShaderMaterial_0ld40"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_gqmmt"]
render_priority = 0
next_pass = SubResource("ShaderMaterial_0ld40")
shader = ExtResource("8_jbj1t")
shader_parameter/brightness = 1.0
shader_parameter/base_color = Color(0.9, 0.2, 0.15, 1)
shader_parameter/use_texture = false
shader_parameter/shadow_strength = 0.25
shader_parameter/shadow_threshold = 0.4

[sub_resource type="SphereShape3D" id="shape_apple"]
radius = 0.12

[sub_resource type="ShaderMaterial" id="ShaderMaterial_yc10j"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_jscy8"]
render_priority = 0
next_pass = SubResource("ShaderMaterial_yc10j")
shader = ExtResource("8_jbj1t")
shader_parameter/brightness = 1.0
shader_parameter/base_color = Color(0.9, 0.2, 0.15, 1)
shader_parameter/use_texture = false
shader_parameter/shadow_strength = 0.25
shader_parameter/shadow_threshold = 0.4

[sub_resource type="ShaderMaterial" id="ShaderMaterial_pm3ni"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_y6deb"]
render_priority = 0
next_pass = SubResource("ShaderMaterial_pm3ni")
shader = ExtResource("8_jbj1t")
shader_parameter/brightness = 1.0
shader_parameter/base_color = Color(0.9, 0.2, 0.15, 1)
shader_parameter/use_texture = false
shader_parameter/shadow_strength = 0.25
shader_parameter/shadow_threshold = 0.4

[sub_resource type="StandardMaterial3D" id="mat_bottle"]
albedo_color = Color(0.2, 0.5, 0.8, 1)
metallic = 0.2
roughness = 0.3

[sub_resource type="CylinderMesh" id="mesh_bottle"]
material = SubResource("mat_bottle")
top_radius = 0.06
bottom_radius = 0.08
height = 0.3

[sub_resource type="ShaderMaterial" id="ShaderMaterial_og1vs"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_2wyq8"]
render_priority = 0
next_pass = SubResource("ShaderMaterial_og1vs")
shader = ExtResource("8_jbj1t")
shader_parameter/brightness = 1.0
shader_parameter/base_color = Color(0.2, 0.5, 0.8, 1)
shader_parameter/use_texture = false
shader_parameter/shadow_strength = 0.25
shader_parameter/shadow_threshold = 0.4

[sub_resource type="CylinderShape3D" id="shape_bottle"]
height = 0.3
radius = 0.08

[sub_resource type="ShaderMaterial" id="ShaderMaterial_vxglm"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_2f3dj"]
render_priority = 0
next_pass = SubResource("ShaderMaterial_vxglm")
shader = ExtResource("8_jbj1t")
shader_parameter/brightness = 1.0
shader_parameter/base_color = Color(0.2, 0.5, 0.8, 1)
shader_parameter/use_texture = false
shader_parameter/shadow_strength = 0.25
shader_parameter/shadow_threshold = 0.4

[sub_resource type="StandardMaterial3D" id="mat_box"]
albedo_color = Color(0.6, 0.45, 0.25, 1)
roughness = 0.9

[sub_resource type="BoxMesh" id="mesh_box"]
material = SubResource("mat_box")
size = Vector3(0.25, 0.25, 0.25)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_yq6so"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_fv21b"]
render_priority = 0
next_pass = SubResource("ShaderMaterial_yq6so")
shader = ExtResource("8_jbj1t")
shader_parameter/brightness = 1.0
shader_parameter/base_color = Color(0.6, 0.45, 0.25, 1)
shader_parameter/use_texture = false
shader_parameter/shadow_strength = 0.25
shader_parameter/shadow_threshold = 0.4

[sub_resource type="BoxShape3D" id="shape_box"]
size = Vector3(0.25, 0.25, 0.25)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_tel4y"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_qkpxi"]
render_priority = 0
next_pass = SubResource("ShaderMaterial_tel4y")
shader = ExtResource("8_jbj1t")
shader_parameter/brightness = 1.0
shader_parameter/base_color = Color(0.6, 0.45, 0.25, 1)
shader_parameter/use_texture = false
shader_parameter/shadow_strength = 0.25
shader_parameter/shadow_threshold = 0.4

[node name="Main" type="Node3D"]

[node name="SceneShaderApplier" type="Node" parent="."]
script = ExtResource("13_ghibli")
scene_wide = true
watch_for_new = false

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_1")
camera_attributes = SubResource("CameraAttributesPractical_1")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.866025, -0.353553, 0.353553, 0, 0.707107, 0.707107, -0.5, -0.612372, 0.612372, 0, 15, 0)
light_color = Color(0.4, 0.5, 0.75, 1)
light_energy = 0.5
shadow_enabled = true
shadow_bias = 0.15
directional_shadow_mode = 0
directional_shadow_max_distance = 30.0

[node name="DayNightCycle" type="Node" parent="."]
script = ExtResource("7_daynight")
day_skybox = ExtResource("1_daysky")
night_skybox = ExtResource("1_nightsky")

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.707107, 0.707107, 0, -0.707107, 0.707107, 3, 10, 10)
far = 60.0
script = ExtResource("3_camera")
target_path = NodePath("../Player")

[node name="ReflectionProbe" type="ReflectionProbe" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 10, 0)
update_mode = 1
size = Vector3(120, 40, 120)

[node name="Shopkeeper" parent="." instance=ExtResource("2_shopkeeper")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 3, 0.005156994, 0)

[node name="NavigationRegion3D" type="NavigationRegion3D" parent="."]
transform = Transform3D(0.23496953, 0, 0, 0, 0.9862821, 0, 0, 0, 0.24789615, 0, 0, 0)
navigation_mesh = SubResource("NavigationMesh_1")

[node name="Floor" type="StaticBody3D" parent="NavigationRegion3D"]
transform = Transform3D(1.0087308, 0, 0, 0, 0.9999999, 0, 0, 0, 0.7607863, 0, 0, 0)

[node name="FloorMesh" type="MeshInstance3D" parent="NavigationRegion3D/Floor"]
cast_shadow = 0
mesh = SubResource("PlaneMesh_1")

[node name="CollisionShape3D" type="CollisionShape3D" parent="NavigationRegion3D/Floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.05, 0)
visible = false
shape = SubResource("BoxShape3D_1")

[node name="Player" parent="." instance=ExtResource("5_player")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 5.164864)

[node name="TODNotification" parent="." instance=ExtResource("8_tod_ui")]
layout_mode = 3

[node name="TODClockWidget" parent="." instance=ExtResource("12_clock")]
layout_mode = 3
day_night_cycle_path = NodePath("../DayNightCycle")

[node name="NPCInfoPanel" parent="." instance=ExtResource("9_npc_info")]
layout_mode = 3

[node name="NPCInfoManager" type="Node" parent="."]
script = ExtResource("10_info_mgr")
info_panel_path = NodePath("../NPCInfoPanel")
camera_path = NodePath("../Camera3D")
player_path = NodePath("../Player")
max_click_distance = null

[node name="GameSpeedManager" type="Node" parent="."]
script = ExtResource("11_speed")

[node name="Items" type="Node3D" parent="."]

[node name="Apple1" type="RigidBody3D" parent="Items"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -2, 0.12, 2)
collision_layer = 8
mass = 0.3
script = ExtResource("6_shop_item")
item_name = "Red Apple"

[node name="Mesh" type="MeshInstance3D" parent="Items/Apple1"]
mesh = SubResource("mesh_apple")
surface_material_override/0 = SubResource("ShaderMaterial_gqmmt")

[node name="Collision" type="CollisionShape3D" parent="Items/Apple1"]
shape = SubResource("shape_apple")

[node name="Apple2" type="RigidBody3D" parent="Items"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1.7, 0.12, 2.1)
collision_layer = 8
mass = 0.3
script = ExtResource("6_shop_item")
item_name = "Red Apple"

[node name="Mesh" type="MeshInstance3D" parent="Items/Apple2"]
mesh = SubResource("mesh_apple")
surface_material_override/0 = SubResource("ShaderMaterial_jscy8")

[node name="Collision" type="CollisionShape3D" parent="Items/Apple2"]
shape = SubResource("shape_apple")

[node name="Apple3" type="RigidBody3D" parent="Items"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1.85, 0.12, 1.8)
collision_layer = 8
mass = 0.3
script = ExtResource("6_shop_item")
item_name = "Red Apple"

[node name="Mesh" type="MeshInstance3D" parent="Items/Apple3"]
mesh = SubResource("mesh_apple")
surface_material_override/0 = SubResource("ShaderMaterial_y6deb")

[node name="Collision" type="CollisionShape3D" parent="Items/Apple3"]
shape = SubResource("shape_apple")

[node name="Bottle1" type="RigidBody3D" parent="Items"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 2, 0.15, -1)
collision_layer = 8
mass = 0.5
script = ExtResource("6_shop_item")
item_name = "Blue Bottle"
value = 2

[node name="Mesh" type="MeshInstance3D" parent="Items/Bottle1"]
mesh = SubResource("mesh_bottle")
surface_material_override/0 = SubResource("ShaderMaterial_2wyq8")

[node name="Collision" type="CollisionShape3D" parent="Items/Bottle1"]
shape = SubResource("shape_bottle")

[node name="Bottle2" type="RigidBody3D" parent="Items"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 2.3, 0.15, -1.2)
collision_layer = 8
mass = 0.5
script = ExtResource("6_shop_item")
item_name = "Blue Bottle"
value = 2

[node name="Mesh" type="MeshInstance3D" parent="Items/Bottle2"]
mesh = SubResource("mesh_bottle")
surface_material_override/0 = SubResource("ShaderMaterial_2f3dj")

[node name="Collision" type="CollisionShape3D" parent="Items/Bottle2"]
shape = SubResource("shape_bottle")

[node name="Box1" type="RigidBody3D" parent="Items"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.125, 3)
collision_layer = 8
script = ExtResource("6_shop_item")
item_name = "Wooden Box"
size = 1
value = 3

[node name="Mesh" type="MeshInstance3D" parent="Items/Box1"]
mesh = SubResource("mesh_box")
surface_material_override/0 = SubResource("ShaderMaterial_fv21b")

[node name="Collision" type="CollisionShape3D" parent="Items/Box1"]
shape = SubResource("shape_box")

[node name="Box2" type="RigidBody3D" parent="Items"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3, 0.125, -2)
collision_layer = 8
script = ExtResource("6_shop_item")
item_name = "Wooden Box"
size = 1
value = 3

[node name="Mesh" type="MeshInstance3D" parent="Items/Box2"]
mesh = SubResource("mesh_box")
surface_material_override/0 = SubResource("ShaderMaterial_qkpxi")

[node name="Collision" type="CollisionShape3D" parent="Items/Box2"]
shape = SubResource("shape_box")

[connection signal="time_of_day_changed" from="DayNightCycle" to="TODNotification" method="show_notification"]
